---
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';
import { withBase } from '../../lib/paths';
import { getTagSummaries } from '../../lib/tags';
import SiteShell from '../../layouts/SiteShell.astro';

const tags = await getTagSummaries();
---

<SiteShell title={`${SITE_TITLE} | Tags`} description={SITE_DESCRIPTION}>
	<section class="tags">
		<h1>Tags</h1>
		<p class="intro">
			Topic hubs group related posts so you can follow a thread from one experiment to the next.
		</p>
		<ul>
			{
				tags.map((tag) => (
					<li>
						<a href={withBase(`/tags/${tag.slug}/`)}>
							<div>
								<strong>{tag.name}</strong>
								<p>{tag.description}</p>
							</div>
							<small>{tag.count} post(s)</small>
						</a>
					</li>
				))
			}
		</ul>
	</section>
</SiteShell>

<style>
	.tags h1 {
		margin-bottom: var(--space-2);
	}

	.intro {
		margin-top: 0;
		margin-bottom: var(--space-5);
		max-width: 62ch;
	}

	.tags ul {
		list-style: none;
		padding: 0;
		margin: 0;
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
		gap: var(--space-2);
	}

	.tags a {
		display: grid;
		grid-template-columns: 1fr auto;
		align-items: start;
		column-gap: 0.55rem;
		row-gap: 0.28rem;
		padding: 0.68rem 0.78rem;
		border-radius: var(--radius-md);
		border: 1px solid var(--line-subtle);
		background: color-mix(in srgb, var(--panel-bg), white 24%);
		text-decoration: none;
		transition:
			transform 140ms ease,
			border-color 140ms ease,
			background 140ms ease;
	}

	.tags a:hover {
		transform: translateY(-1px);
		border-color: color-mix(in srgb, var(--link), white 48%);
		background: color-mix(in srgb, var(--panel-bg), white 30%);
	}

	.tags a strong {
		display: block;
		margin: 0;
		color: var(--text-strong);
		font-size: 0.84rem;
		line-height: 1.2;
	}

	.tags a p {
		grid-column: 1 / -1;
		margin: 0;
		font-size: 0.76rem;
		color: var(--text-muted);
		line-height: 1.34;
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
		min-height: 2.7em;
	}

	.tags small {
		color: var(--text-muted);
		white-space: nowrap;
		font-size: 0.72rem;
		border: 1px solid color-mix(in srgb, var(--line-subtle), transparent 14%);
		background: color-mix(in srgb, var(--panel-bg), white 22%);
		border-radius: 999px;
		padding: 0.08rem 0.36rem;
		align-self: start;
	}

	:root[data-theme='dark'] .tags a {
		background: color-mix(in srgb, var(--panel-bg), #173f49 48%);
		border-color: color-mix(in srgb, var(--line-subtle), #86cada 20%);
	}

	:root[data-theme='dark'] .tags a:hover {
		background: color-mix(in srgb, var(--panel-bg), #1b4f5b 54%);
		border-color: color-mix(in srgb, var(--link), #9fe3f1 30%);
	}

	@media (max-width: 720px) {
		.tags ul {
			grid-template-columns: repeat(2, minmax(0, 1fr));
		}
	}
</style>
