---
import FormattedDate from './FormattedDate.astro';
import { withBase } from '../lib/paths';
import { tagToSlug } from '../lib/tags';

interface Props {
	href: string;
	title: string;
	description: string;
	pubDate: Date | string;
	tags?: string[];
}

const { href, title, description, pubDate, tags = [] } = Astro.props;
const postHref = href.startsWith('http') ? href : withBase(href);
---

<article class="post-card">
	<h3>
		<a href={postHref} class="post-link">{title}</a>
	</h3>
	<p>{description}</p>
	{
		tags.length > 0 && (
			<ul class="tags">
				{tags.map((tag) => <li><a href={withBase(`/tags/${tagToSlug(tag)}/`)}>{tag}</a></li>)}
			</ul>
		)
	}
	<div class="post-meta">
		<FormattedDate date={pubDate} />
	</div>
</article>

<style>
	.post-card {
		padding: var(--space-5);
		border: 1px solid var(--line-subtle);
		border-radius: var(--radius-md);
		background: color-mix(in srgb, var(--panel-bg), white 34%);
		content-visibility: auto;
		contain-intrinsic-size: 220px;
		box-shadow:
			0 1px 1px rgba(8, 43, 50, 0.06),
			0 10px 24px rgba(8, 43, 50, 0.08);
		transition:
			transform 180ms ease,
			box-shadow 180ms ease,
			border-color 180ms ease,
			background 180ms ease;
	}

	.post-card:hover {
		transform: translateY(-2px);
		border-color: color-mix(in srgb, var(--link), white 38%);
		box-shadow:
			0 1px 1px rgba(8, 43, 50, 0.08),
			0 18px 34px rgba(8, 43, 50, 0.14);
		background: color-mix(in srgb, var(--panel-bg), white 44%);
	}

	.post-card h3 {
		margin-bottom: var(--space-2);
		font-size: clamp(1.24rem, 1.08rem + 0.42vw, 1.54rem);
	}

	.post-link {
		text-decoration: none;
		color: inherit;
	}

	.post-link:hover {
		color: var(--link-hover);
	}

	.post-card p {
		margin-bottom: var(--space-3);
		max-width: 64ch;
	}

	.tags {
		display: flex;
		flex-wrap: wrap;
		gap: 0.35rem;
		list-style: none;
		margin: 0 0 var(--space-3);
		padding: 0;
	}

	.tags a {
		display: inline-flex;
		padding: 0.16rem 0.45rem;
		border-radius: 999px;
		font-size: 0.74rem;
		border: 1px solid color-mix(in srgb, var(--line-subtle), transparent 35%);
		background: color-mix(in srgb, var(--panel-bg), white 24%);
		color: var(--text-strong);
		text-decoration: none;
	}

	.tags a:hover {
		background: color-mix(in srgb, var(--line-subtle), transparent 35%);
	}

	:root[data-theme="dark"] .tags a {
		background: color-mix(in srgb, var(--panel-bg), #1e5b67 38%);
		border-color: color-mix(in srgb, var(--line-subtle), #89c8d5 18%);
	}

	.post-meta {
		font-size: 0.84rem;
		color: var(--text-muted);
	}
</style>
