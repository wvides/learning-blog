---
import { SITE_TITLE } from '../consts';
import { withBase } from '../lib/paths';
import HeaderLink from './HeaderLink.astro';
---

<header class="site-header">
	<nav aria-label="Primary">
		<a class="brand" href={withBase('/')}>{SITE_TITLE}</a>
		<div class="nav-links">
			<HeaderLink href="/about">About</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/now">Now</HeaderLink>
			<HeaderLink href="/uses">Uses</HeaderLink>
			<HeaderLink href="/tags">Tags</HeaderLink>
			<button
				type="button"
				class="theme-toggle"
				aria-label="Switch to dark theme"
				aria-pressed="false"
				data-theme-toggle
			>
				<span aria-hidden="true" data-theme-icon>◑</span>
			</button>
		</div>
	</nav>
</header>

<script is:inline>
	(() => {
		const key = 'learning-blog-theme';
		const root = document.documentElement;
		const button = document.querySelector('[data-theme-toggle]');
		const icon = document.querySelector('[data-theme-icon]');
		if (!button || !icon) return;

		const sync = (theme) => {
			root.dataset.theme = theme;
			const darkMode = theme === 'dark';
			button.setAttribute('aria-pressed', String(darkMode));
			button.setAttribute('aria-label', darkMode ? 'Switch to light theme' : 'Switch to dark theme');
			icon.textContent = darkMode ? '☀' : '◑';
		};

		const current = root.dataset.theme === 'dark' ? 'dark' : 'light';
		sync(current);

		button.addEventListener('click', () => {
			const next = root.dataset.theme === 'dark' ? 'light' : 'dark';
			sync(next);
			try {
				localStorage.setItem(key, next);
			} catch (_) {}
		});
	})();
</script>

<style>
	.site-header {
		padding: 0.8rem 1.25rem;
		border-bottom: 1px solid var(--line-subtle);
		background: color-mix(in srgb, var(--panel-bg), white 26%);
	}

	nav {
		width: min(960px, calc(100% - 0.75rem));
		margin: 0 auto;
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1rem;
	}

	.brand {
		font-family: var(--font-body);
		font-weight: 600;
		font-size: 0.8rem;
		letter-spacing: 0.045em;
		text-transform: uppercase;
		text-decoration: none;
		color: var(--text-strong);
	}

	.nav-links {
		display: inline-flex;
		align-items: center;
		gap: 0.25rem;
	}

	.theme-toggle {
		border: 1px solid color-mix(in srgb, var(--line-subtle), var(--text-strong) 16%);
		background: color-mix(in srgb, var(--panel-bg), white 20%);
		color: var(--text-strong);
		font: inherit;
		padding: 0.3rem 0.48rem;
		border-radius: 999px;
		cursor: pointer;
		opacity: 0.84;
		font-size: 0.8rem;
		line-height: 1;
	}

	.theme-toggle:hover {
		opacity: 1;
		border-color: color-mix(in srgb, var(--text-strong), white 60%);
	}

	@media (max-width: 720px) {
		.site-header {
			padding: 0.75rem 0.65rem;
		}

		nav {
			width: calc(100% - 0.3rem);
		}
	}
</style>
